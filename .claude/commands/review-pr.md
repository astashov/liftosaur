# Review Pull Request

Review a pull request for safety and potential issues. The PR number is: $ARGUMENTS

## Running in Headless Mode

To run this command non-interactively with full permissions:
```bash
claude -p "/review-pr $ARGUMENTS" --settings .claude/settings.headless.json
```

## Steps

### 1. Fetch PR Details

Get the PR information including description, files changed, and diff:

```bash
gh pr view $ARGUMENTS --json title,body,author,baseRefName,headRefName,additions,deletions,changedFiles
```

```bash
gh pr diff $ARGUMENTS
```

### 2. Analyze Changes

Review the diff carefully, looking for:

**Critical Issues (DANGEROUS):**
- Data loss or corruption (deleting user data, clearing storage, overwriting history)
- Breaking changes to IStorage, IProgram, IHistoryRecord or other core types without migration
- Removing or changing existing API endpoints without backwards compatibility
- Security vulnerabilities (XSS, injection, auth bypass, exposed secrets)
- Changes to payment/subscription logic that could affect billing
- Modifying sync logic that could cause data conflicts
- Destructive database operations
- Removing error handling or safety checks
- Changes to Liftoscript parser that could break existing programs

**Warning Signs (needs scrutiny):**
- Changes to state management (reducer, thunks)
- Modifications to IndexedDB or storage layer
- Changes affecting offline functionality
- Updates to migration logic
- Modifying shared utilities used across the codebase
- Large refactors touching many files

**Generally Safe:**
- UI-only changes (styling, text, layout)
- Adding new optional features that don't modify existing data
- Test additions or updates
- Documentation changes
- Adding new exercises or equipment to static lists
- Linting/formatting fixes

### 3. Cross-Reference with Codebase

For any suspicious changes, verify:
- How the modified code is used elsewhere
- Whether the change maintains backwards compatibility
- If type changes are properly propagated
- That error handling remains intact

Use Grep and Read tools to understand the impact of changes.

### 4. Render Verdict

Based on your analysis, output one of the following verdicts:

**If SAFE:**
```
VERDICT: ‚úÖ SAFE

This PR is safe to merge.

Summary:
- <brief summary of what the PR does>

Why it's safe:
- <reasons why the changes are low-risk>
```

**If DANGEROUS:**
```
VERDICT: ‚ö†Ô∏è DANGEROUS

This PR has potential issues that need addressing.

Summary:
- <brief summary of what the PR does>

Issues found:
- <list of specific concerns with file:line references>

Recommendations:
- <what should be fixed or verified before merging>
```

### 5. Comment on PR (if DANGEROUS)

If the verdict is DANGEROUS, add a review comment to the PR:

```bash
gh pr review $ARGUMENTS --comment --body "## ü§ñ Automated Code Review

‚ö†Ô∏è **Potential issues detected**

<issues found>

### Recommendations
<what should be fixed>

---
*This review was generated by Claude Code*"
```

Do NOT comment if the PR is safe - only comment when there are concerns.
